# Netplan configuration for {{ inventory_hostname }}
# Managed by Ansible - DO NOT EDIT MANUALLY
# Network interfaces configured via host_vars

network:
  version: 2
  ethernets:
{% for interface in interfaces %}
    {{ interface.name }}:
{% if interface.type == 'static' %}
      addresses:
        - {{ interface.address }}
{% if interface.gateway is defined %}
      routes:
        - to: default
          via: {{ interface.gateway }}
{% endif %}
{% if interface.dns is defined %}
      nameservers:
        addresses:
{% for dns in interface.dns %}
          - {{ dns }}
{% endfor %}
        search:
          - {{ lab_domain }}
{% endif %}
{% elif interface.type == 'dhcp' %}
      dhcp4: true
{% if interface.dhcp4_overrides is defined %}
      dhcp4-overrides:
{% if interface.dhcp4_overrides.use_routes is defined %}
        use-routes: {{ interface.dhcp4_overrides.use_routes | lower }}
{% endif %}
{% if interface.dhcp4_overrides.use_dns is defined %}
        use-dns: {{ interface.dhcp4_overrides.use_dns | lower }}
{% endif %}
{% endif %}
{% if interface.dhcp6 is defined and interface.dhcp6 %}
      dhcp6: true
{% if interface.dhcp6_overrides is defined %}
      dhcp6-overrides:
{% if interface.dhcp6_overrides.use_routes is defined %}
        use-routes: {{ interface.dhcp6_overrides.use_routes | lower }}
{% endif %}
{% if interface.dhcp6_overrides.use_dns is defined %}
        use-dns: {{ interface.dhcp6_overrides.use_dns | lower }}
{% endif %}
{% endif %}
{% endif %}
{% endif %}
{% endfor %}
